<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Login y Registro</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
    <style>
        html, body {
            height: 100%;
        }
        body {
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0;
            padding: 0;
            background-image: url('Fondo/zona2.png');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
        }
        .auth-container {
            background: rgba(255, 255, 255, 0.9);
            padding: 2rem;
            border-radius: 0.5rem;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            max-width: 400px;
            width: 100%;
        }
        .auth-logo {
            display: block;
            margin: 0 auto 1rem auto;
            max-width: 150px;
            height: auto;
        }
    </style>
</head>
<body>
    <div class="auth-container">
        <h2 class="mb-4 text-center">Sistema de Autenticación</h2>
        <ul class="nav nav-tabs" id="authTab" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="login-tab" data-bs-toggle="tab" data-bs-target="#login" type="button" role="tab" aria-controls="login" aria-selected="true">Iniciar Sesión</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="register-tab" data-bs-toggle="tab" data-bs-target="#register" type="button" role="tab" aria-controls="register" aria-selected="false">Registrarse</button>
            </li>
        </ul>
        <div class="tab-content mt-3" id="authTabContent">
            <div class="tab-pane fade show active" id="login" role="tabpanel" aria-labelledby="login-tab">
                <form id="loginForm" novalidate>
                    <div class="mb-3">
                        <label for="loginEmail" class="form-label">Correo</label>
                        <input type="email" class="form-control" id="loginEmail" required />
                        <div class="invalid-feedback">Por favor, ingresa un correo válido.</div>
                    </div>
                    <div class="mb-3">
                        <label for="loginPassword" class="form-label">Contraseña</label>
                        <input type="password" class="form-control" id="loginPassword" required minlength="6" />
                        <div class="invalid-feedback">Por favor, ingresa tu contraseña.</div>
                    </div>
                    <div class="mb-3 text-danger" id="loginError" style="display:none;"></div>
                    <button type="submit" class="btn btn-primary w-100">Iniciar Sesión</button>
                </form>
            </div>
            <div class="tab-pane fade" id="register" role="tabpanel" aria-labelledby="register-tab">
                <form id="registerForm" novalidate>
                    <div class="mb-3">
                        <label for="registerName" class="form-label">Nombre</label>
                        <input type="text" class="form-control" id="registerName" required />
                        <div class="invalid-feedback">Por favor, ingresa tu nombre.</div>
                    </div>
                    <div class="mb-3">
                        <label for="registerEmail" class="form-label">Correo</label>
                        <input type="email" class="form-control" id="registerEmail" required />
                        <div class="invalid-feedback">Por favor, ingresa un correo válido.</div>
                    </div>
                    <div class="mb-3">
                        <label for="registerPassword" class="form-label">Contraseña</label>
                        <input type="password" class="form-control" id="registerPassword" required minlength="6" />
                        <div class="invalid-feedback">La contraseña debe tener al menos 6 caracteres.</div>
                    </div>
                    <div class="mb-3 text-danger" id="registerError" style="display:none;"></div>
                    <button type="submit" class="btn btn-success w-100">Registrarse</button>
                </form>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS Bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        // Load users from localStorage or return empty array
        function loadUsers() {
            return JSON.parse(localStorage.getItem("users") || "[]");
        }

        // Save users array to localStorage
        function saveUsers(users) {
            localStorage.setItem("users", JSON.stringify(users));
        }

        // Registration
        const registerForm = document.getElementById("registerForm");
        registerForm.addEventListener("submit", function(event) {
            event.preventDefault();
            const nameInput = document.getElementById("registerName");
            const emailInput = document.getElementById("registerEmail");
            const passwordInput = document.getElementById("registerPassword");
            const registerError = document.getElementById("registerError");

            // Reset errors
            registerError.style.display = "none";
            registerError.textContent = "";

            // Simple validation
            let valid = true;

            if (!nameInput.value.trim()) {
                valid = false;
                nameInput.classList.add("is-invalid");
            } else {
                nameInput.classList.remove("is-invalid");
            }

            // Basic email validation
            if (!emailInput.value.trim() || !emailInput.checkValidity()) {
                valid = false;
                emailInput.classList.add("is-invalid");
            } else {
                emailInput.classList.remove("is-invalid");
            }

            if (passwordInput.value.length < 6) {
                valid = false;
                passwordInput.classList.add("is-invalid");
            } else {
                passwordInput.classList.remove("is-invalid");
            }

            if (!valid) return;

            const users = loadUsers();
            // Check if email already registered
            if (users.some(u => u.email.toLowerCase() === emailInput.value.toLowerCase())) {
                registerError.textContent = "El correo ya está registrado.";
                registerError.style.display = "block";
                return;
            }

            users.push({
                name: nameInput.value.trim(),
                email: emailInput.value.trim().toLowerCase(),
                password: passwordInput.value,
                role: emailInput.value.trim().toLowerCase() === 'ministrylion@gmail.com' ? 'admin' : 'user'
            });

            saveUsers(users);

            alert("Registro exitoso. Ahora puedes iniciar sesión.");
            registerForm.reset();
            // Switch to login tab after registration
            const loginTab = new bootstrap.Tab(document.querySelector('#login-tab'));
            loginTab.show();
        });

        // Login
        const loginForm = document.getElementById("loginForm");
        loginForm.addEventListener("submit", function(event) {
            event.preventDefault();
            const emailInput = document.getElementById("loginEmail");
            const passwordInput = document.getElementById("loginPassword");
            const loginError = document.getElementById("loginError");

            // Reset errors
            loginError.style.display = "none";
            loginError.textContent = "";

            // Validation
            let valid = true;

            // Basic email validation
            if (!emailInput.value.trim() || !emailInput.checkValidity()) {
                valid = false;
                emailInput.classList.add("is-invalid");
            } else {
                emailInput.classList.remove("is-invalid");
            }

            if (!passwordInput.value) {
                valid = false;
                passwordInput.classList.add("is-invalid");
            } else {
                passwordInput.classList.remove("is-invalid");
            }

            if (!valid) return;

            const users = loadUsers();
            const user = users.find(u => u.email === emailInput.value.toLowerCase() && u.password === passwordInput.value);

            if (!user) {
                loginError.textContent = "Correo o contraseña incorrectos.";
                loginError.style.display = "block";
                return;
            }

            // Store current user with role in localStorage
            localStorage.setItem('user', JSON.stringify(user));

            // On successful login, redirect based on role
            if (user.role === 'admin') {
                window.location.href = "administrador.html";
            } else {
                window.location.href = "admin_panel.html";
            }
        });
    </script>
</body>
</html>
